--- sqlite3.c.unpatched	2024-07-29 16:00:31
+++ sqlite3.c	2024-07-29 16:01:29
@@ -1,3 +1,5 @@
+#pragma clang diagnostic ignored "-Wambiguous-macro"
+#pragma clang diagnostic ignored "-Wshorten-64-to-32"
 /******************************************************************************
 ** This file is an amalgamation of many separate C source files from SQLite
 ** version 3.45.3.  By combining all the individual C code files into this
@@ -184928,7 +184930,10 @@
     return 0;
   }
 #endif
-  return db->lastRowid;
+  sqlite3_mutex_enter(db->mutex);
+  i64 lastRowId = db->lastRowid;
+  sqlite3_mutex_leave(db->mutex);
+  return lastRowId;
 }
 
 /*
